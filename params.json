{"name":"Moodle-format topcoll","tagline":"Collapsed Topics course format for Moodle.","body":"﻿Introduction\r\n============\r\nTopic based course format with an individual 'toggle' for each topic except 0.\r\n\r\nIf you find an issue with the format, please see the 'Reporting Issues' section below.\r\n\r\n[![Build Status](https://travis-ci.org/gjb2048/moodle-format_topcoll.svg?branch=master)](https://travis-ci.org/gjb2048/moodle-format_topcoll)\r\n\r\nRequired version of Moodle\r\n==========================\r\nThis version works with Moodle version 2015111600.00 3.0 (Build: 20151116) and above within the 3.0 branch until the\r\nnext release.\r\n\r\nPlease ensure that your hardware and software complies with 'Requirements' in 'Installing Moodle' on\r\n'docs.moodle.org/30/en/Installing_Moodle'.\r\n\r\nDownloads and documentation\r\n===========================\r\nThe primary source for downloading this branch of the format is https://moodle.org/plugins/view.php?plugin=format_topcoll\r\nwith 'Select Moodle version:' set at 'Moodle 3.0'.\r\n\r\nThe secondary source is a tagged version with the v3.0 prefix on https://github.com/gjb2048/moodle-format_topcoll/tags\r\n\r\nIf you download from the development area - https://github.com/gjb2048/moodle-format_topcoll/ - consider that\r\nthe code is unstable and not for use in production environments.  This is because I develop the next version in stages\r\nand use GitHub as a means of backup.  Therefore the code is not finished, subject to alteration and requires testing.\r\n\r\nDocumented on http://docs.moodle.org/30/en/Collapsed_Topics_course_format\r\n\r\nBespoke changes\r\n===============\r\nWould you like a bespoke Collapsed Topics? Contact me via www.gjbarnard.co.uk/contact/ for a competitive quote.\r\n\r\nFree software\r\n=============\r\nThe Collapsed Topics format is 'free' software under the terms of the GNU GPLv3 License, please see 'COPYING.txt'.\r\n\r\nIt can be obtained for free from the links in 'Downloads and documentation' above.\r\n\r\nYou have all the rights granted to you by the GPLv3 license.  If you are unsure about anything, then the\r\nFAQ - http://www.gnu.org/licenses/gpl-faq.html - is a good place to look.\r\n\r\nIf you reuse any of the code then I kindly ask that you make reference to the format.\r\n\r\nIf you make improvements or bug fixes then I would appreciate if you would send them back to me by forking from\r\nhttps://github.com/gjb2048/moodle-format_topcoll and doing a 'Pull Request' so that the rest of the\r\nMoodle community benefits.\r\n\r\nSponsorships\r\n============\r\nCollapsed Topics is provided to you for free, and if you want to express your gratitude for using this format, please consider\r\nsponsoring by:\r\n\r\nPayPal - Please contact me via my 'Moodle profile' (above) for details as I am an individual and therefore am unable to have\r\n'buy me now' buttons under their terms.\r\n\r\nFlattr - https://flattr.com/profile/gjb2048\r\n\r\nSponsorships may allow me to provide you with more or better features in less time.\r\n\r\nNew features for this Moodle 3.0 version\r\n========================================\r\n 1. Same features as version 2.9.1.5 in Moodle 2.9.\r\n\r\nInstallation\r\n============\r\n 1. Ensure you have the version of Moodle as stated above in 'Required version of Moodle'.  This is essential as the\r\n    format relies on underlying core code that is out of my control.\r\n 2. If upgrading from Moodle 1.9, 2.0 or 2.1, please see 'Upgrading from Moodle 1.9, 2.0 or 2.1' below.\r\n 3. If upgrading from Moodle 2.2, please see 'Upgrading from Moodle 2.2' below.\r\n 4. If upgrading from Moodle 2.3, please see 'Upgrade Instructions' below.\r\n 5. Put Moodle in 'Maintenance Mode' (docs.moodle.org/en/admin/setting/maintenancemode) so that there are no \r\n    users using it bar you as the administrator - if you have not already done so.\r\n 6. Copy 'topcoll' to '/course/format/' if you have not already done so.\r\n 7. In 'Site Administration -> Plugins -> Course formats -> Collapsed Topics' change the values of 'defaultlayoutelement',\r\n    'defaultlayoutstructure' and 'defaultlayoutcolumns' for setting the default layout, structure and columns respectively\r\n    for new / updating courses as desired by following the instructions contained within.\r\n 8. In 'Site Administration -> Plugins -> Course formats -> Collapsed Topics' change the values of 'defaulttgfgcolour',\r\n    'defaulttgbgcolour' and 'defaulttgbghvrcolour' for setting the default toggle colours.\r\n 9. In 'Site Administration -> Plugins -> Course formats -> Collapsed Topics' turn off toggle persistence if desired by\r\n    changing 'defaulttogglepersistence' as indicated.\r\n10. In 'Site Administration -> Plugins -> Course formats -> Collapsed Topics' set the default toggle alignment by changing\r\n    'defaulttogglealignment' as indicated.\r\n11. Login as an administrator and follow standard the 'plugin' update notification.  If needed, go to\r\n    'Site administration' -> 'Notifications' if this does not happen.\r\n12.  To change the arrow graphic please see 'Icon Sets' below.\r\n13.  Put Moodle out of Maintenance Mode.\r\n\r\nUpgrade Instructions\r\n====================\r\n1. Ensure you have the version of Moodle as stated above in 'Required version of Moodle'.  This is essential as the\r\n   format relies on underlying core code that is out of my control.\r\n2. If upgrading from Moodle 1.9, 2.0, 2.1 or 2.2 please read the appropriate sections below.\r\n3. Put Moodle in 'Maintenance Mode' so that there are no users using it bar you as the administrator.\r\n4. In '/course/format/' move old 'topcoll' directory to a backup folder outside of Moodle.\r\n5. Follow installation instructions above.\r\n6. If automatic 'Purge all caches' appears not to work by lack of display etc. then perform a manual 'Purge all caches'\r\n   under 'Home -> Site administration -> Development -> Purge all caches'.\r\n7. Put Moodle out of Maintenance Mode.\r\n\r\nUpgrading from Moodle 1.9, 2.0 or 2.1\r\n-------------------------------------\r\nMoodle 2.4 requires that Moodle 2.2 is installed to upgrade from, so therefore Moodle 2.2 is an intermediate step.\r\nSo:\r\n1. Put Moodle in 'Maintenance Mode' so that there are no users using it bar you as the administrator.\r\n2. In '/course/format/' move old 'topcoll' directory to a backup folder outside of Moodle.\r\n3. Do not copy in the new version of 'topcoll' yet!  As this will cause the upgrade to fail.\r\n4. Upgrade to Moodle 2.2 first - http://docs.moodle.org/22/en/Upgrading_to_Moodle_2.2.\r\n5. After you have installed Moodle 2.2, now upgrade to Moodle 2.4 with this new topcoll -\r\n   http://docs.moodle.org/24/en/Upgrading_to_Moodle_2.4 - but before initiating the upgrade you can copy the\r\n   new (i.e. this) 'topcoll' folder to '/course/format'.\r\n6. Now follow 'Upgrading from Moodle 2.2' below please.\r\nINFO: Having no 'topcoll' folder in '/course/format' is fine as the courses that use it are not accessed and\r\n      both the old and new versions will confuse an intermediate 2.2 version and cause it's installation to fail.\r\n\r\nUpgrading from Moodle 2.2\r\n-------------------------\r\n1.    Put Moodle in 'Maintenance Mode' so that there are no users using it bar you as the administrator - if you have\r\n      not already done so.\r\n2.    In '/course/format/' move old 'topcoll' directory to a backup folder outside of Moodle - if you have not\r\n      already done so.\r\n3.    Copy this new 'topcoll' folder to '/course/format/'.\r\n4.    Upgrade to Moodle 2.4 by being logged in as 'admin' and clicking on 'Home'.  If you have previously upgraded but\r\n      'topcoll' was an old version and the upgrade failed, this should still work.\r\n5.    Follow installation instructions above.\r\n6.    Put Moodle out of Maintenance Mode.\r\nNOTE: If the automated upgrade fails for which can be seen by getting errors when using a Collapsed Topics course,\r\n      then please follow this.\r\n      Please carry on if a table / field has been removed / changed / already exists as it should still work - this \r\n      is to cope with the different possible scenarios.  These instructions are written with the MySQL database in\r\n      mind, however should work with other database engines but the types should be compared with other tables in \r\n      the database to get an idea of what they should be.  If possible please kindly feedback to me any additional\r\n      information you discover so I can update these instructions - contact details at the very bottom.\r\n      The table prefix i.e, 'mdl_' is not stated in the instructions but ensure you know what yours is and use\r\n      it with the table names.\r\n1.    In your database:\r\n2.1   Rename the table 'format_topcoll_layout' to 'format_topcoll_settings'.\r\n2.2   With the table 'format_topcoll_settings' change all integer types to signed if using a MySQL database.\r\n2.3   If the table 'format_topcoll_settings' does not exist, then create it and add the following fields \r\n      in this order:\r\n2.3.1 'id' of type 'BIGINT(10)' type, not null, auto increment, no zero fill with a null default value - the same \r\n       as any other 'id' field in the other tables.  Make it the primary key.\r\n2.3.2 'courseid' of type 'BIGINT(10)' type, not null, no auto increment, no zero fill with a null default value - the\r\n      same as the 'course' field in the 'course_sections' table bar the default value.\r\n2.3.3 'layoutelement' of type 'TINYINT(2)' type, not null, no auto increment, no zero fill with a default value\r\n      of '1'.\r\n2.3.4 'layoutstructure' of type 'TINYINT(1)' type, not null, no auto increment, no zero fill with a default value\r\n      of '1'.\r\n2.4   With the table 'format_topcoll_settings' append three new fields of 'VARCHAR(6)' type, not null, called\r\n      'tgfgcolour', 'tgbgcolour' and 'tgbghvrcolour' in that order with the default values of '000000', 'e2e2f2'\r\n      and 'eeeeff' respectively.\r\n2.5   With the table 'format_topcoll_settings' append a new field 'layoutcolumns' after the 'layoutstructure' field\r\n      and with identical size, type and attributes.  The default is '1'. i.e:\r\n2.5.1 'layoutcolumns' of type 'TINYINT(1)' type, not null, no auto increment, no zero fill with a default value\r\n      of '1'.\r\n2.6   Drop the table 'format_topcoll_cookie_cnsnt'.\r\n\r\nUninstallation\r\n==============\r\n1. Put Moodle in 'Maintenance Mode' so that there are no users using it bar you as the administrator.\r\n2. It is recommended but not essential to change all of the courses that use the format to another.  If this is\r\n   not done Moodle will pick the last format in your list of formats to use but display in 'Edit settings' of the\r\n   course the first format in the list.  You can then set the desired format.\r\n3. In '/course/format/' remove the folder 'topcoll'.\r\n4. In the database, remove the table 'format_topcoll_settings' along with the entry for 'format_topcoll'\r\n   ('plugin' attribute) in the table 'config_plugins'.  If using the default prefix this will be\r\n   'mdl_format_topcoll_settings' and 'mdl_config_plugins' respectively.\r\n5. Put Moodle out of Maintenance Mode.\r\n\r\nCourse Backup and Restore Instructions\r\n======================================\r\n1. Backup as you would any other course.  The layout configuration will be stored with the course settings.\r\n2. Restore as you would any other course.  If you are offered the option of 'Overwrite Course Configuration'\r\n   you must say 'Yes' to have the layout configuration restored otherwise the restored course will retain the\r\n   layout it previously had or the default in the 'config.php' file as mentioned in the 'Installation'\r\n   instructions above depending on the situation.\r\n3. Note: I believe that if you restore a Collapsed Topic's course on an installation that does not have the\r\n         format then it will work and become the default course format.  However the layout data will not be\r\n         stored if you install Collapsed Topic's at a later date.\r\n\r\nRemembered Toggle State Information\r\n===================================\r\nThe state of the toggles are remembered beyond the session on a per user per course basis though the employment\r\nof a user preference.  This functionality is now built in from previous versions.  You do not need to do anything.\r\n\r\nIcon Sets\r\n=========\r\nIcon sets allow you to choose what is the most appropriate set of icons to use for a given courses demographic.  They\r\nare set on a per course basis but with all the functionality of the other settings in respect to a default and resetting\r\nthe current or all courses.\r\n\r\nIf you want to change what icon represents which state / action, then edit 'styles.css' and change the selectors with\r\nthe 'background' attribute with a 'toggle-...' type class within them.  There are selectors for both the 'toggles' and\r\nthe 'toggle all' functionality.  For example:\r\n\r\n    body.jsenabled .course-content ul.ctopics li.section .content .toggle-arrow a.toggle_closed {\r\n        background-image: url([[pix:format_topcoll|arrow_right]]);\r\n    }\r\n\r\n    #toggle-all .content .toggle-arrow h4 a.off {\r\n        background-image: url([[pix:format_topcoll|arrow_down]]); \r\n    }\r\n\r\nIf you would like your own icon set, either replace the icons in the 'pix' folder, deduce how the code works or better\r\nstill create new icons yourself and ask me to add them to the release.  If you do the latter then the icons must be your\r\nown for which you grant the same GPL licence as [Moodle](http://www.gnu.org/copyleft/gpl.html) or provide direct evidence\r\nof the originator under the same licence.  The icons must be 24x24 pixels with a transparent background.\r\n\r\nKnown Issues\r\n============\r\n1.  If you get toggle text issues in languages other than English please ensure you have the latest version of Moodle installed.\r\n    More information on http://moodle.org/mod/forum/discuss.php?d=184150.\r\n2.  Importing a Moodle 1.9 course does not currently work, please see CONTRIB-3552 which depends on MDL-32205 - as\r\n    a workaround, please select the 'Topics' format first in 1.9, backup and restore then select the Collapsed Topics\r\n    course format in the course settings.  You will have to reset your decisions on structure etc.\r\n3.  Sometimes when restoring a course, it is accessed for the first time and a toggle is clicked a 'Error updating user\r\n    preference 'topcoll_toggle_x'' (where 'x' is the course id as shown in the URL 'id=x') can occur.  I'm not completely sure\r\n    why this is happening as the 'user_preference_allow_ajax_update' call in 'format.php' should establish that the user\r\n    preference can be set.  Could be a page cache thing as the 'init' code is getting the course id unlike an issue I'm\r\n    currently experiencing with the MyMobile theme - MDL-33115.  The work around is to refresh the page.  Having altered some\r\n    of the event handing code to operate after page load, I'm hoping that this has now been resolved, please let me know\r\n    if you encounter it.\r\n\r\nReporting Issues\r\n================\r\nBefore reporting an issue, please ensure that you are running the latest version for your release of Moodle.  The primary\r\nrelease area is located on https://moodle.org/plugins/view.php?plugin=format_topcoll.  It is also essential that you are\r\noperating the required version of Moodle as stated at the top - this is because the format relies on core functionality that\r\nis out of its control.\r\n\r\nAll Collapsed Topics does is integrate with the course page and control it's layout, therefore what may appear to be an issue\r\nwith the format is in fact to do with a theme or core component.  Please be confident that it is an issue with Collapsed Topics\r\nbut if in doubt, ask.\r\n\r\nI operate a policy that we will fix all genuine issues for free (this only applies to the code as supplied from the sources listed\r\nin 'Downloads and documentation' above.  Any changes / improvements you make are not covered and invalidate this policy for all of\r\nthe code).  Improvements are at my discretion.  I am happy to make bespoke customisations / improvements for a negotiated fee.  I\r\nwill endeavour to respond to all requests for support as quickly as possible, if you require a faster service then offering payment\r\nfor the service will expedite the response.\r\n\r\nWhen reporting an issue you can post in the course format's forum on Moodle.org (currently 'moodle.org/mod/forum/view.php?id=47'), \r\non Moodle tracker 'tracker.moodle.org' ensuring that you chose the 'Non-core contributed modules' and 'Course Format: Topcoll'\r\nfor the component or contact me direct (details at the bottom).\r\n\r\nIt is essential that you provide as much information as possible, the critical information being the contents of the format's \r\nversion.php file.  Other version information such as specific Moodle version, theme name and version also helps.  A screen shot\r\ncan be really useful in visualising the issue along with any files you consider to be relevant.\r\n\r\nVersion Information\r\n===================\r\nSee Changes.md.\r\n\r\nThanks\r\n======\r\nI would like to thank Anthony Borrow - arborrow@jesuits.net & anthony@moodle.org - for his invaluable input.\r\n\r\nCraig Grannell of Snub Communications who wrote the article on Collapsed Tables in .Net Magazine Issue 186 from whom\r\nthe original code is based and concept used with his permission.\r\n\r\nFor the persistence upgrade I would like to thank all those who contributed to the\r\n[developer forum](http://moodle.org/mod/forum/discuss.php?d=124264) - Frank Ralf, Matt Gibson, Howard Miller and Tim Hunt.  And\r\nindeed all those who have worked on the developer documentation - http://docs.moodle.org/en/Javascript_FAQ.\r\n\r\nMichael de Raadt for CONTRIB-1945 & 1946 which sparked fixes in CONTRIB-1952 & CONTRIB-1954.\r\n\r\n[Amanda Doughty](http://moodle.org/user/profile.php?id=1062329) for her contribution in solving the AJAX move problem.\r\n\r\n[Mark Ward](http://moodle.org/user/profile.php?id=489101) for his contribution solving the IE8- display problem.\r\n\r\n[Pieter Wolters](http://moodle.org/user/profile.php?id=537037) - for the Dutch translation.\r\n\r\n[Tarcísio Nunes](http://moodle.org/user/profile.php?id=1149633) - for the Brazilian translation.\r\n\r\n[Pavel Evgenjevich Timoshenko](http://moodle.org/user/profile.php?id=1322784) - for the Russian translation.\r\n\r\nAll of the developers of the [Grid Course format](https://github.com/PukunuiAustralia/moodle-courseformat_grid) for showing how\r\nthe database can be used with a course format.\r\n\r\n[Carlos Sánchez Martín](http://moodle.org/user/profile.php?id=743362) for his assistance on CONTRIB-3378 and the\r\nSpanish translation.\r\n\r\n[Andrew Nicols](http://moodle.org/user/view.php?id=268794) for his assistance on CONTRIB-3378.\r\n\r\n[Hartmut Scherer](http://moodle.org/user/view.php?id=441502) for suggesting the 'Current Topic First' structure and testing the\r\nMoodle 2.2 code on discussion [Collapsed Topics with Custom Layouts](http://moodle.org/mod/forum/discuss.php?d=195292).\r\n\r\n[Luiggi Sansonetti](http://moodle.org/user/profile.php?id=1297063) for the French translation.\r\n\r\nReferences\r\n==========\r\n.Net Magazine Issue 186 - Article on Collapsed Tables by Craig Grannell -\r\n http://www.netmag.co.uk/zine/latest-issue/issue-186\r\n\r\nCraig Grannell - http://www.snubcommunications.com/\r\n\r\nAccordion Format - Initiated the thought - http://moodle.org/mod/forum/discuss.php?d=44773 & \r\n                                           http://www.moodleman.net/archives/47\r\n\r\nPaint.Net - http://www.getpaint.net/\r\n\r\nJavaScript: The Definitive Guide - David Flanagan - O'Reilly - ISBN: 978-0-596-10199-2\r\n\r\nDesired Enhancements\r\n====================\r\n1. Smoother animated toggle action.\r\n2. Toggle saving only when the user closes the window / moves to another course.\r\n\r\nMe\r\n==\r\nG J Barnard MSc. BSc(Hons)(Sndw). MBCS. CEng. CITP. PGCE.\r\nMoodle profile: http://moodle.org/user/profile.php?id=442195.\r\nWeb profile   : http://about.me/gjbarnard\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}